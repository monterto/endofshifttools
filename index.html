<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>End of Shift Tools</title>
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="./manifest.json">
  
  <!-- Theme colors -->
  <meta name="theme-color" content="#4da3ff">
  <meta name="msapplication-TileColor" content="#4da3ff">
  
  <!-- iOS specific meta tags -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="EoS Tools">
  <link rel="apple-touch-icon" href="./icon-192.png">
  <link rel="apple-touch-icon" sizes="192x192" href="./icon-192.png">
  <link rel="apple-touch-icon" sizes="512x512" href="./icon-512.png">
  
  <!-- Standard favicon -->
  <link rel="icon" type="image/png" sizes="192x192" href="./icon-192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="./icon-512.png">
  
  <!-- Windows tiles -->
  <meta name="msapplication-TileImage" content="./icon-512.png">
  
  <style>
    :root {
      --bg: #0f1115;
      --card: #1a1d24;
      --text: #e6e6eb;
      --muted: #9aa0aa;
      --accent: #4da3ff;
      --border: #2a2e39;
      --warning: #ff6b6b;
      --success: #51cf66;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      background: linear-gradient(135deg, var(--bg) 0%, #1a1d3d 100%);
      color: var(--text);
      min-height: 100vh;
      overflow-x: hidden;
    }

    #hubView {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 2rem 1rem;
    }

    .hub-header {
      text-align: center;
      margin-bottom: 3rem;
    }

    .hub-header h1 {
      font-size: 2.5rem;
      margin-bottom: 0.5rem;
      background: linear-gradient(135deg, var(--accent), #8b5cf6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .info-button {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      width: 56px;
      height: 56px;
      background: var(--accent);
      border: none;
      border-radius: 50%;
      color: white;
      font-size: 1.5rem;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(77, 163, 255, 0.4);
      transition: all 0.3s ease;
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .info-button:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 16px rgba(77, 163, 255, 0.6);
    }

    .info-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      padding: 1rem;
    }

    .info-modal.show {
      display: flex;
    }

    .info-content {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 2rem;
      max-width: 500px;
      width: 100%;
      max-height: 80vh;
      overflow-y: auto;
    }

    .info-content h2 {
      margin-top: 0;
      margin-bottom: 1rem;
      color: var(--accent);
    }

    .info-content h3 {
      margin-top: 1.5rem;
      margin-bottom: 0.5rem;
      color: var(--text);
      font-size: 1.1rem;
    }

    .info-content p {
      color: var(--muted);
      line-height: 1.6;
      margin-bottom: 1rem;
    }

    .info-content ol {
      color: var(--muted);
      line-height: 1.8;
      padding-left: 1.5rem;
      margin-bottom: 1rem;
    }

    .info-content li {
      margin-bottom: 0.5rem;
    }

    .close-modal {
      background: var(--accent);
      color: white;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      width: 100%;
      margin-top: 1rem;
      font-weight: 600;
    }

    .close-modal:hover {
      background: #3d8fe6;
    }

    .app-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1.5rem;
      max-width: 1000px;
      width: 100%;
    }

    .app-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 2rem;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .app-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background: linear-gradient(90deg, var(--accent), #8b5cf6);
      transform: scaleX(0);
      transition: transform 0.3s ease;
    }

    .app-card:hover {
      transform: translateY(-4px);
      border-color: var(--accent);
      box-shadow: 0 8px 24px rgba(77, 163, 255, 0.2);
    }

    .app-card:hover::before {
      transform: scaleX(1);
    }

    .app-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
      display: block;
    }

    .app-card h3 {
      font-size: 1.3rem;
      margin-bottom: 0.5rem;
    }

    .app-card p {
      color: var(--muted);
      font-size: 0.9rem;
      line-height: 1.5;
    }

    #appView {
      display: none;
      flex-direction: column;
      min-height: 100vh;
    }

    #appView.active {
      display: flex;
    }

    .app-header {
      background: var(--card);
      border-bottom: 1px solid var(--border);
      padding: 1rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .back-btn {
      background: none;
      border: none;
      color: var(--accent);
      font-size: 1rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      transition: background 0.2s;
    }

    .back-btn:hover {
      background: rgba(77, 163, 255, 0.1);
    }

    .app-title {
      font-size: 1.2rem;
      font-weight: 600;
    }

    .app-content {
      flex: 1;
      overflow-y: auto;
    }

    @media (max-width: 640px) {
      .hub-header h1 {
        font-size: 2rem;
      }
      
      .app-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div id="hubView">
    <div class="hub-header">
      <h1><span id="hubEmoji">üê∑</span> End of Shift Tools</h1>
    </div>

    <div class="app-grid">
      <div class="app-card" id="tipCalcCard">
        <span class="app-icon">üí∞</span>
        <h3>Tip Breakdown</h3>
        <p>Calculate tip distribution between BoH, FoH, and final tips</p>
      </div>

      <div class="app-card" id="hoursCalcCard">
        <span class="app-icon">‚è∞</span>
        <h3>Hours Calculator</h3>
        <p>Track work hours with exact and rounded time</p>
      </div>

      <div class="app-card" id="endOfDayCard">
        <span class="app-icon">üìä</span>
        <h3>End of Day</h3>
        <p>Calculate hourly rate from hours and tips</p>
      </div>
    </div>

    <button class="info-button" id="infoBtn">‚ÑπÔ∏è</button>

    <div class="info-modal" id="infoModal">
      <div class="info-content">
        <h2>üì± Install as an App</h2>
        <p>Install End of Shift Tools on your phone for quick access and offline use!</p>
        
        <h3>iPhone/iPad (Safari)</h3>
        <ol>
          <li>Tap the <strong>Share button</strong> (square with arrow ‚Üë)</li>
          <li>Scroll down and tap <strong>"Add to Home Screen"</strong></li>
          <li>Tap <strong>"Add"</strong> in the top right</li>
        </ol>
        
        <h3>Android (Chrome)</h3>
        <ol>
          <li>Tap the <strong>three-dot menu</strong> (‚ãÆ)</li>
          <li>Tap <strong>"Add to Home screen"</strong> or <strong>"Install app"</strong></li>
          <li>Tap <strong>"Install"</strong></li>
        </ol>
        
        <button class="close-modal" id="closeModalBtn">Got it!</button>
      </div>
    </div>
  </div>

  <div id="appView">
    <div class="app-header">
      <button class="back-btn" id="backBtn">
        <span>‚Üê</span>
        <span>Back to Hub</span>
      </button>
      <div class="app-title" id="currentAppTitle"></div>
      <div style="width: 100px;"></div>
    </div>
    <div class="app-content" id="appContainer"></div>
  </div>

  <script>
    // Randomize hub emoji on load
    const pigEmojis = ["üêΩ", "üêñ", "üê∑"];
    document.getElementById('hubEmoji').textContent = pigEmojis[Math.floor(Math.random() * pigEmojis.length)];

    // Event listeners - wait for DOM to load
    document.addEventListener('DOMContentLoaded', function() {
      // App cards
      document.getElementById('tipCalcCard').addEventListener('click', function() {
        loadApp('tipcalc');
      });
      document.getElementById('hoursCalcCard').addEventListener('click', function() {
        loadApp('hourscalc');
      });
      document.getElementById('endOfDayCard').addEventListener('click', function() {
        loadApp('endofday');
      });
      
      // Back button
      document.getElementById('backBtn').addEventListener('click', backToHub);
      
      // Info modal
      document.getElementById('infoBtn').addEventListener('click', openInfoModal);
      document.getElementById('closeModalBtn').addEventListener('click', closeInfoModal);
      document.getElementById('infoModal').addEventListener('click', function(e) {
        if (e.target.id === 'infoModal') {
          closeInfoModal();
        }
      });
    });

    function openInfoModal() {
      document.getElementById('infoModal').classList.add('show');
    }

    function closeInfoModal() {
      document.getElementById('infoModal').classList.remove('show');
    }

    function loadApp(appName) {
      document.getElementById('hubView').style.display = 'none';
      document.getElementById('appView').classList.add('active');
      
      const container = document.getElementById('appContainer');
      
      if (appName === 'tipcalc') {
        document.getElementById('currentAppTitle').textContent = 'Tip Breakdown';
        container.innerHTML = getTipCalcHTML();
        initTipCalc();
      } else if (appName === 'hourscalc') {
        document.getElementById('currentAppTitle').textContent = 'Hours Calculator';
        container.innerHTML = getHoursCalcHTML();
        initHoursCalc();
      } else if (appName === 'endofday') {
        document.getElementById('currentAppTitle').textContent = 'End of Day';
        container.innerHTML = getEndOfDayHTML();
        initEndOfDay();
      }
    }

    function backToHub() {
      document.getElementById('appView').classList.remove('active');
      document.getElementById('hubView').style.display = 'flex';
      document.getElementById('appContainer').innerHTML = '';
    }

    function getTipCalcHTML() {
      return `
<style>
  .tip-app {
    width: 100%;
    max-width: 420px;
    margin: 1rem auto;
    background-color: var(--card);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 1rem;
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }
  .tip-field {
    display: flex;
    flex-direction: column;
    gap: 0.2rem;
  }
  .tip-field label {
    font-size: 0.8rem;
    color: var(--muted);
    font-weight: 500;
  }
  .tip-field input {
    width: 100%;
    background-color: #0c0e13;
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 0.65rem;
    font-size: 1.1rem;
    color: var(--text);
    font-weight: 600;
  }
  .tip-field input:focus {
    outline: none;
    border-color: var(--accent);
  }
  .tip-field input.error {
    border-color: var(--warning);
  }
  .percent-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0.5rem;
  }
  .tip-outputs {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    margin-top: 0.25rem;
  }
  .tip-output {
    background-color: #0c0e13;
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 0.75rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .tip-output span {
    font-size: 0.85rem;
    color: var(--muted);
    font-weight: 500;
  }
  .tip-output strong {
    font-size: 1.3rem;
    font-weight: 700;
  }
  .tip-output.negative strong {
    color: var(--warning);
  }
  .tip-output.highlight {
    border-color: var(--accent);
    border-width: 2px;
    padding: 0.85rem 0.75rem;
  }
  .tip-output.highlight strong {
    font-size: 1.5rem;
    color: var(--accent);
  }
  .tip-buttons {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0.5rem;
    margin-top: 0.25rem;
  }
  .tip-btn {
    background-color: #0c0e13;
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 0.65rem;
    color: var(--text);
    cursor: pointer;
    transition: all 0.2s;
    font-size: 0.85rem;
    font-weight: 500;
  }
  .tip-btn:hover {
    border-color: var(--accent);
    background-color: rgba(77, 163, 255, 0.1);
  }
  .tip-warning {
    background-color: rgba(255, 107, 107, 0.1);
    border: 1px solid var(--warning);
    border-radius: 6px;
    padding: 0.6rem;
    color: var(--warning);
    font-size: 0.8rem;
    display: none;
    text-align: center;
    font-weight: 500;
  }
  .tip-warning.show {
    display: block;
  }
  .tip-pig {
    margin-top: 0.5rem;
    text-align: center;
    font-size: 1.4rem;
    animation: bounce 2s ease-in-out infinite;
  }
  @keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-6px); }
  }
  
  @media (max-width: 400px) {
    .tip-app {
      padding: 0.75rem;
      gap: 0.6rem;
      margin: 0.5rem auto;
    }
    .tip-field input {
      padding: 0.55rem;
      font-size: 1rem;
    }
    .tip-output {
      padding: 0.6rem;
    }
    .tip-output strong {
      font-size: 1.2rem;
    }
    .tip-output.highlight {
      padding: 0.7rem 0.6rem;
    }
    .tip-output.highlight strong {
      font-size: 1.35rem;
    }
    .tip-buttons {
      gap: 0.4rem;
    }
    .tip-btn {
      padding: 0.55rem;
      font-size: 0.8rem;
    }
  }
</style>

<div class="tip-app">
  <div class="tip-field">
    <label>Owed</label>
    <input id="owed" type="number" step="0.01" placeholder="0.00" inputmode="decimal" />
  </div>

  <div class="tip-field">
    <label>Total Net Sales</label>
    <input id="sales" type="number" step="0.01" placeholder="0.00" inputmode="decimal" />
  </div>

  <div class="percent-row">
    <div class="tip-field">
      <label>BoH %</label>
      <input id="bohPercent" type="number" step="0.01" inputmode="decimal" />
    </div>
    <div class="tip-field">
      <label>FoH %</label>
      <input id="fohPercent" type="number" step="0.01" inputmode="decimal" />
    </div>
  </div>

  <div class="tip-buttons">
    <button class="tip-btn" id="savePreset">Save Preset</button>
    <button class="tip-btn" id="clearBtn">Clear All</button>
  </div>

  <div class="tip-warning" id="warningBox">
    ‚ö†Ô∏è Final tips are negative!
  </div>

  <div class="tip-outputs">
    <div class="tip-output">
      <span>BoH</span>
      <strong id="boh">$0.00</strong>
    </div>
    <div class="tip-output">
      <span>FoH</span>
      <strong id="foh">$0.00</strong>
    </div>
    <div class="tip-output highlight" id="tipsOutput">
      <span>Final Tips</span>
      <strong id="tips">$0.00</strong>
    </div>
  </div>

  <div class="tip-pig" id="pigDisplay"></div>
</div>`;
    }

    function initTipCalc() {
      const DEFAULT_BOH = 5;
      const DEFAULT_FOH = 3;

      const owed = document.getElementById("owed");
      const sales = document.getElementById("sales");
      const bohPercent = document.getElementById("bohPercent");
      const fohPercent = document.getElementById("fohPercent");
      const bohEl = document.getElementById("boh");
      const fohEl = document.getElementById("foh");
      const tipsEl = document.getElementById("tips");
      const tipsOutput = document.getElementById("tipsOutput");
      const warningBox = document.getElementById("warningBox");
      const pigDisplay = document.getElementById("pigDisplay");
      const savePresetBtn = document.getElementById("savePreset");
      const clearBtn = document.getElementById("clearBtn");

      const round2 = n => Math.round(n * 100) / 100;
      const usd = n => `$${round2(n).toFixed(2)}`;

      function validateInput(input) {
        const value = parseFloat(input.value);
        if (input.value && (isNaN(value) || value < 0)) {
          input.classList.add('error');
          return false;
        } else {
          input.classList.remove('error');
          return true;
        }
      }

      function calculate() {
        const validInputs = [
          validateInput(owed),
          validateInput(sales),
          validateInput(bohPercent),
          validateInput(fohPercent)
        ].every(v => v);

        if (!validInputs) return;

        const o = parseFloat(owed.value) || 0;
        const s = parseFloat(sales.value) || 0;
        const bohP = (parseFloat(bohPercent.value) || 0) / 100;
        const fohP = (parseFloat(fohPercent.value) || 0) / 100;

        const boh = s * bohP;
        const foh = s * fohP;
        const tips = o - (boh + foh);

        bohEl.textContent = usd(boh);
        fohEl.textContent = usd(foh);
        tipsEl.textContent = usd(tips);

        if (tips < 0) {
          warningBox.classList.add('show');
          tipsOutput.classList.add('negative');
        } else {
          warningBox.classList.remove('show');
          tipsOutput.classList.remove('negative');
        }
      }

      function loadPreset() {
        const saved = localStorage.getItem('tipCalcPreset');
        if (saved) {
          const preset = JSON.parse(saved);
          bohPercent.value = preset.boh;
          fohPercent.value = preset.foh;
        } else {
          bohPercent.value = DEFAULT_BOH;
          fohPercent.value = DEFAULT_FOH;
        }
        calculate();
      }

      savePresetBtn.addEventListener('click', function() {
        const bohVal = parseFloat(bohPercent.value) || 0;
        const fohVal = parseFloat(fohPercent.value) || 0;
        
        if (bohVal >= 0 && fohVal >= 0) {
          localStorage.setItem('tipCalcPreset', JSON.stringify({
            boh: bohVal,
            foh: fohVal
          }));
          savePresetBtn.textContent = '‚úì Saved!';
          setTimeout(function() {
            savePresetBtn.textContent = 'Save Preset';
          }, 2000);
        }
      });

      clearBtn.addEventListener('click', function() {
        owed.value = '';
        sales.value = '';
        bohPercent.value = '';
        fohPercent.value = '';
        loadPreset();
      });

      const pigs = ["üêΩ", "üêñ", "üê∑"];
      const money = ["üí∏", "üí∞", "üíµ"];
      pigDisplay.textContent = pigs[Math.floor(Math.random() * pigs.length)] + 
                              money[Math.floor(Math.random() * money.length)];

      [owed, sales, bohPercent, fohPercent].forEach(function(el) {
        el.addEventListener("input", calculate);
      });

      loadPreset();
    }

    function getHoursCalcHTML() {
      return `
<style>
  .hours-app {
    width: 100%;
    max-width: 420px;
    margin: 2rem auto;
    background-color: var(--card);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 1.25rem;
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }
  .hours-field {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }
  .hours-field label {
    font-size: 0.9rem;
    color: var(--muted);
  }
  .hours-field input {
    width: 100%;
    background-color: #0c0e13;
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 0.6rem;
    font-size: 1rem;
    color: var(--text);
  }
  .hours-field input:focus {
    outline: none;
    border-color: var(--accent);
  }
  .hours-output {
    background-color: #0c0e13;
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 0.6rem;
  }
  .hours-output strong {
    font-size: 1.05rem;
  }
  .hours-bounce {
    margin-top: 15px;
    font-size: 2em;
    animation: bounce 1.5s ease-in-out infinite;
    text-align: center;
  }
  @keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-6px); }
  }
</style>

<div class="hours-app">
  <div class="hours-field">
    <label>Start Time</label>
    <input id="start" type="time" />
  </div>

  <div class="hours-field">
    <label>End Time</label>
    <input id="end" type="time" />
  </div>

  <div class="hours-field">
    <label>Break Time (minutes)</label>
    <input id="breakTime" type="number" min="0" step="1" placeholder="0" value="0" />
  </div>

  <div class="hours-field">
    <label>Exact Time Elapsed</label>
    <div class="hours-output">
      <strong id="exactTime">0h 0m</strong>
    </div>
  </div>

  <div class="hours-field">
    <label>Time After Break</label>
    <div class="hours-output">
      <strong id="afterBreak">0h 0m</strong>
    </div>
  </div>

  <div class="hours-field">
    <label>Rounded Time</label>
    <div class="hours-output">
      <strong id="roundedTime">0.0h</strong>
    </div>
  </div>

  <div class="hours-bounce" id="emojiDisplay"></div>
</div>`;
    }

    function initHoursCalc() {
      const pigEmojis = ["üêΩ", "üêñ", "üê∑"];
      const clockEmojis = ["‚è∞", "üïê", "‚è≥"];
      document.getElementById('emojiDisplay').textContent = 
        pigEmojis[Math.floor(Math.random() * pigEmojis.length)] +
        clockEmojis[Math.floor(Math.random() * clockEmojis.length)];

      const startInput = document.getElementById('start');
      const endInput = document.getElementById('end');
      const breakInput = document.getElementById('breakTime');
      const exactDiv = document.getElementById('exactTime');
      const afterBreakDiv = document.getElementById('afterBreak');
      const roundedDiv = document.getElementById('roundedTime');

      function updateHours() {
        const startVal = startInput.value;
        const endVal = endInput.value;
        const breakMin = parseInt(breakInput.value) || 0;

        if (!startVal || !endVal) {
          exactDiv.textContent = "0h 0m";
          afterBreakDiv.textContent = "0h 0m";
          roundedDiv.textContent = "0.0h";
          return;
        }

        const startParts = startVal.split(':').map(Number);
        const endParts = endVal.split(':').map(Number);
        const startH = startParts[0];
        const startM = startParts[1];
        const endH = endParts[0];
        const endM = endParts[1];

        var start = new Date();
        start.setHours(startH, startM, 0, 0);

        var end = new Date();
        end.setHours(endH, endM
